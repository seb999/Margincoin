<!-- Trading Board -->
<div class="space-y-4">
  <!-- Header -->
  <h1 class="text-2xl font-bold text-white">Trading Board</h1>

  <!-- Main Grid -->
  <div class="grid grid-cols-12 gap-4">
    <!-- Left Sidebar - Coin Info -->
    <div class="col-span-12 lg:col-span-3">
      <div class="bg-gray-800 rounded-lg border border-gray-700 p-4 space-y-3">
        <!-- Coin Icon & Symbol -->
        <div class="flex items-center gap-3">
          <img *ngIf="coinData.s"
               src='{{ "assets/images/CoinIcon/" + coinData.s.substring(0,coinData.s.length-4) + ".png" }}'
               class="w-10 h-10 rounded-full"
               alt="Coin icon" />
          <div>
            <span class="text-lg font-bold text-white">{{coinData.s}}</span>
          </div>
        </div>

        <!-- Price Info -->
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-400">Price</span>
            <span class="text-white font-mono">{{coinData.c}}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">24hr Change</span>
            <span [class]="((coinData.p/coinData.c)*100) >= 0 ? 'text-green-400 font-mono' : 'text-red-400 font-mono'">
              {{((coinData.p/coinData.c)*100).toFixed(2)}}%
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Volume</span>
            <span class="text-white font-mono">{{(coinData.q*1).toFixed(2)}}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">RSI</span>
            <span class="text-white font-mono">--</span>
          </div>
        </div>

        <!-- Interval Selector -->
        <div class="pt-2">
          <label class="block text-xs text-gray-400 mb-1">Interval</label>
          <select class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                  [(ngModel)]="interval"
                  (change)="changeHighstockResolution(interval)">
            <option *ngFor="let item of intervalList" [value]="item.value">{{ item.value }}</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Right Content - Orders -->
    <div class="col-span-12 lg:col-span-9">
      <div class="bg-gray-800 rounded-lg border border-gray-700">
        <!-- Orders Header -->
        <div class="p-4 border-b border-gray-700">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <h2 class="text-lg font-semibold text-white">Orders</h2>
            <div class="flex flex-wrap items-center gap-2">
              <button class="px-3 py-1.5 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
                      (click)="openPopUpOrder(popupNewEditOrder)">
                <i class="fa-solid fa-plus mr-1"></i>Buy
              </button>
              <button class="px-3 py-1.5 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
                      (click)="openPopupOrderTemplate(popupOrderTemplate)">
                <i class="fa-solid fa-file-lines mr-1"></i>Trade Template
              </button>
              <button class="px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded-md transition-colors"
                      (click)="startTrade()">
                <i class="fa-solid fa-play mr-1"></i>Start
              </button>
              <button class="px-3 py-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors"
                      (click)="stopTrade()">
                <i class="fa-solid fa-stop mr-1"></i>Stop
              </button>
            </div>
            <!-- Alert Message -->
            <div *ngIf="showMessageInfo"
                 class="px-3 py-1.5 text-xs font-medium text-red-400 bg-red-900/30 border border-red-700 rounded-md">
              {{serverMsg?.msgName}}
            </div>
          </div>
        </div>

        <!-- Orders Table -->
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-900/50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Amount</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-gray-400 uppercase tracking-wider">Quantity</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-gray-400 uppercase tracking-wider">Price</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-gray-400 uppercase tracking-wider hidden md:table-cell">Margin</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-gray-400 uppercase tracking-wider">%</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-gray-400 uppercase tracking-wider">Profit</th>
                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-400 uppercase tracking-wider hidden lg:table-cell">Stop Loss</th>
                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-400 uppercase tracking-wider">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
              <tr *ngFor="let order of openOrderList" class="hover:bg-gray-700/50 transition-colors">
                <td class="px-4 py-3 text-white font-mono">{{order.openPrice * order.quantity * order.margin}}</td>
                <td class="px-4 py-3 text-right text-white font-mono">{{order.quantity}}</td>
                <td class="px-4 py-3 text-right text-white font-mono">{{order.openPrice}}</td>
                <td class="px-4 py-3 text-right text-white font-mono hidden md:table-cell">{{order.margin}}</td>
                <td class="px-4 py-3 text-right font-mono"
                    [class]="(((coinData.c-order.openPrice) / (order.openPrice))*100) >= 0 ? 'text-green-400' : 'text-red-400'">
                  {{ (((coinData.c-order.openPrice) / (order.openPrice))*100).toFixed(2) }}
                </td>
                <td class="px-4 py-3 text-right font-mono"
                    [class]="(coinData.c-order.openPrice)*order.quantity*order.margin >= 0 ? 'text-green-400' : 'text-red-400'">
                  {{((coinData.c-order.openPrice)*order.quantity*order.margin).toFixed(2)}}
                </td>
                <td class="px-4 py-3 text-center hidden lg:table-cell">
                  <div class="flex items-center justify-center gap-1">
                    <button class="px-2 py-1 text-xs text-white bg-gray-600 hover:bg-gray-500 rounded transition-colors"
                            (click)="changeTakeProfitOffset('reduce')">-</button>
                    <button class="px-2 py-1 text-xs text-white bg-gray-600 hover:bg-gray-500 rounded transition-colors"
                            (click)="changeTakeProfitOffset('increase')">+</button>
                  </div>
                </td>
                <td class="px-4 py-3 text-center">
                  <button class="px-3 py-1 text-xs font-medium text-red-400 bg-red-900/30 hover:bg-red-900/50 rounded-md transition-colors"
                          (click)="closeOrder(order.id, coinData.c)">
                    Sell
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-12 gap-4">
    <!-- Depth Chart -->
    <div class="col-span-12 lg:col-span-5" *ngIf="chartOptions2">
      <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <!-- Bid/Ask Ratio Bar -->
        <div class="flex h-1.5 rounded-full overflow-hidden mb-2">
          <div class="bg-green-500 transition-all duration-300" [style.width]="bidRatio + '%'"></div>
          <div class="bg-red-500 transition-all duration-300" [style.width]="askRatio + '%'"></div>
        </div>
        <highcharts-chart
          constructorType='stockChart'
          [Highcharts]="highcharts2"
          [options]="chartOptions2"
          style="width: 100%; height: 550px; display: block;">
        </highcharts-chart>
      </div>
    </div>

    <!-- Main Chart -->
    <div class="col-span-12 lg:col-span-7" *ngIf="chartOptions">
      <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <highcharts-chart
          constructorType='stockChart'
          [Highcharts]="highcharts"
          [options]="chartOptions"
          style="width: 100%; height: 550px; display: block;">
        </highcharts-chart>
      </div>
    </div>
  </div>
</div>

<!-- Popup Order Modal -->
<ng-template #popupNewEditOrder let-modal>
  <div class="bg-gray-800 rounded-lg border border-gray-700 shadow-xl">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-700">
      <h3 class="text-lg font-semibold text-white">
        {{popupTitle}}
        <span [class]="((coinData.p/coinData.c)*100) >= 0 ? 'text-green-400 ml-2' : 'text-red-400 ml-2'">
          {{((coinData.p/coinData.c)*100).toFixed(2)}}%
        </span>
      </h3>
      <button type="button"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Close"
              (click)="modal.dismiss('Cross click')">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-4">
      <form class="space-y-4">
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="openPrice" class="col-span-3 text-sm text-gray-400">Price</label>
          <div class="col-span-9">
            <input id="openPrice" type="number"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   [value]="orderModel.openPrice"
                   name="openPrice"
                   [(ngModel)]="orderModel.openPrice"
                   (change)="processFormInputChange('price')">
          </div>
        </div>
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="amount" class="col-span-3 text-sm text-gray-400">Amount</label>
          <div class="col-span-9">
            <input id="amount"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="amount"
                   required
                   [(ngModel)]="orderModel.amount"
                   (change)="processFormInputChange('amount')">
          </div>
        </div>
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="quantity" class="col-span-3 text-sm text-gray-400">Quantity</label>
          <div class="col-span-9">
            <input id="quantity"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="quantity"
                   required
                   [(ngModel)]="orderModel.quantity"
                   (change)="processFormInputChange('quantity')">
          </div>
        </div>
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="margin" class="col-span-3 text-sm text-gray-400">Leverage</label>
          <div class="col-span-9">
            <input id="margin"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="margin"
                   required
                   [(ngModel)]="orderModel.margin">
          </div>
        </div>
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="stop" class="col-span-3 text-sm text-gray-400">Stop (%)</label>
          <div class="col-span-4">
            <input id="stop"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="stop"
                   required
                   [(ngModel)]="orderModel.stopLose">
          </div>
          <div class="col-span-5">
            <input id="pourcent"
                   class="w-full bg-gray-600 border border-gray-600 rounded-md px-3 py-2 text-sm text-gray-400 cursor-not-allowed"
                   name="pourcent"
                   [value]="orderModel.amount*orderModel.stopLose*orderModel.margin/100"
                   disabled>
          </div>
        </div>
      </form>
    </div>

    <!-- Modal Footer -->
    <div class="flex justify-end gap-2 p-4 border-t border-gray-700">
      <button type="button"
              class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors"
              (click)="modal.dismiss()"
              ngbAutofocus>
        Cancel
      </button>
      <button *ngIf="orderModel.id==0"
              type="submit"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
              (click)="modal.close('continue')">
        Place Order
      </button>
    </div>
  </div>
</ng-template>

<!-- Popup Order Template Modal -->
<ng-template #popupOrderTemplate let-modal>
  <div class="bg-gray-800 rounded-lg border border-gray-700 shadow-xl">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-700">
      <h3 class="text-lg font-semibold text-white">Order Template</h3>
      <button type="button"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Close"
              (click)="modal.dismiss('Cross click')">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-4">
      <form class="space-y-4">
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="amount" class="col-span-3 text-sm text-gray-400">Amount</label>
          <div class="col-span-9">
            <input id="amount"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="amount"
                   required
                   [(ngModel)]="orderTemplate.amount">
          </div>
        </div>
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="margin" class="col-span-3 text-sm text-gray-400">Leverage</label>
          <div class="col-span-9">
            <input id="margin"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="margin"
                   required
                   [(ngModel)]="orderTemplate.margin">
          </div>
        </div>
        <div class="grid grid-cols-12 gap-3 items-center">
          <label for="stopLose" class="col-span-3 text-sm text-gray-400">Stop (%)</label>
          <div class="col-span-4">
            <input id="stopLose"
                   class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                   name="stopLose"
                   required
                   [(ngModel)]="orderTemplate.stopLose">
          </div>
          <div class="col-span-5">
            <input id="pourcentage"
                   class="w-full bg-gray-600 border border-gray-600 rounded-md px-3 py-2 text-sm text-gray-400 cursor-not-allowed"
                   name="pourcentage"
                   [value]="orderTemplate.amount*orderTemplate.stopLose*orderTemplate.margin/100"
                   disabled>
          </div>
        </div>
      </form>
    </div>

    <!-- Modal Footer -->
    <div class="flex justify-end gap-2 p-4 border-t border-gray-700">
      <button type="button"
              class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors"
              (click)="modal.dismiss()"
              ngbAutofocus>
        Cancel
      </button>
      <button type="submit"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
              (click)="modal.close('continue')">
        Save Template
      </button>
    </div>
  </div>
</ng-template>

<!-- Popup Confirm Delete Modal -->
<ng-template #popupConfirmDelete let-modal>
  <div class="bg-gray-800 rounded-lg border border-gray-700 shadow-xl">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-700">
      <h3 class="text-lg font-semibold text-white">{{popupTitle}}</h3>
      <button type="button"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Close"
              (click)="modal.dismiss('Cross click')">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>

    <!-- Modal Footer -->
    <div class="flex justify-end gap-2 p-4 border-t border-gray-700">
      <button type="button"
              class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors"
              (click)="modal.dismiss()"
              ngbAutofocus>
        Cancel
      </button>
      <button type="button"
              class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors"
              (click)="modal.close('deleteContent')">
        Delete
      </button>
    </div>
  </div>
</ng-template>
